<?

/*
Grinnell Plans. A web-based version of social .plans.
Copyright (C) 2002 by Jonathan Kensler

---

This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

---
If you need to contact me you may so at:
kenslerj@grinnell.edu

or

Jonathan Kensler
Box 07-04 Grinnell College
Grinnell, IA 50112

*/


function disp_begin($dbh,$idcookie,$myurl,$myprivl,$cssloc,$jsfile)
{
if (!$myprivl == 2 or !$myprivl == 3)
 {$myprivl = 1;}

?>
<html>
<head>
<title>Plans 2</title>
<link rel=stylesheet
href="<?=$cssloc?>">
<?
if ( !is_null( $jsfile ) )
    echo "<script language=\"javascript\" type=\"text/javascript\" src=\"$jsfile\"></script>";
?>
</head>
<body>

<table width="100%" cellspacing="0" cellpadding="0"
class="main">
<tr>
<td valign="top" align="left" class="left" width="12%">
<table class="mainpanel"><tr><td>
<p class="logo">&nbsp;</p>
<Form action="read.php" method="post">
<input name="searchname" type="text"><br>
<input type="hidden" name="myprivl" value="<? echo $myprivl; ?>">
<input type="submit" value="Read"></form>

<table class="lowerpanel"><tr>
<td><p class="imagelev1">&nbsp;</p></td><td></td><td></td>
<td><a href="edit.php?myprivl=<? echo $myprivl;?>" class="main">edit 
plan</a></td>
</tr>


<tr>
<td><p class="imagelev1">&nbsp;</p></td><td></td><td></td>
<td><a href="listusers.php?myprivl=<? echo $myprivl;?>" class="main">list 
users</a></td>
</tr>

<tr>
<td><p class="imagelev1">&nbsp;</p></td><td></td><td></td>
<td><a href="search.php?myprivl=<? echo $myprivl;?>"
class="main">search plans</a></td>
</tr>

<tr>
<td><p class="imagelev1">&nbsp;</p></td><td></td><td></td>
<td><a href="customize.php?myprivl=<? echo $myprivl;?>"
class="main">preferences</a></td>
</tr>
<?

$linkarray = mysql_query("Select avail_links.html_code
From avail_links, opt_links where 
opt_links.userid = '$idcookie' and opt_links.linknum = avail_links.linknum");
    while($new_row = mysql_fetch_row($linkarray)) {
      $linklist[] = $new_row;
    }

$o=0;
while ($linklist[$o][0])
{
?>
<tr>
<td><p class="imagelev1">&nbsp;</p></td><td></td><td></td>
<td><?=$linklist[$o][0]?></td>
</tr>
<?
 $o++;}

?>

<tr>
<td><p class="imagelev1">&nbsp;</p></td><td></td><td></td>
<td><a href="index.php" class="main">log out</a></td>
</tr>

<tr><td><br></td><td><br></td><td><br></td><td><br></td></tr>

</table>
</td></tr></table>
</td>
<td>


<table>

<tr><td>

<?

} 


function priority_link($myurl, $notprivl)
{

if (ereg("myprivl", $myurl))
{$myurlx = ereg_replace("myprivl=[0-9]{0,1}", "myprivl=" . $notprivl,
$myurl);
}//if already has privl
else { //if doesn't already have privl
if (ereg("\?", $myurl)) // if has ? but not privl
{$myurlx = $myurl . "&myprivl=" . $notprivl;}
else  //must add on extra info
{$myurlx= $myurl . "?myprivl=" . $notprivl;}
}//else, if doesn't already have privl
 
echo "<tr><td></td><td><p class=\"imagelev2\">&nbsp;</p></td><td></td>";  
echo "<td><a href=\"http://" . $myurlx . "\" class=\"lev2\">level " .
$notprivl .
"</a></td></tr>";
}//function priority_link



function mdisp_end($dbh,$idcookie,$myurl,$myprivl)
{

if (!$myprivl == 2 or !$myprivl == 3)
 {$myprivl = 1;}



?>
</td></tr></table></td><td 
valign="top" align="left" class="right" 
width="22%">
<table class="mainpanel"><tr><td>
<table class="lowerpanel">

<tr><td><p 
class="imagelev1">&nbsp;</p></td><td></td><td></td>
<td><p class="main">auto read list</p></td>
</tr>

<?


//get autoread list
if (ereg("index.php", $myurl)) // if has ? but not privl
{$myurl = ereg_replace("index.php", "blank.php", $myurl);}


if (!($myprivl == 1))
{priority_link($myurl, 1);
if (!($myprivl == 2))
{priority_link($myurl, 2);}
}

echo "<tr><td></td><td><p
class=\"imagelev2\">&nbsp;</p></td><td></td><td><p 
class=\"lev2\">level " . $myprivl . "</p></td></tr>";


$privarray = mysql_query("Select autofinger.interest,accounts.username
From autofinger, accounts where owner = '$idcookie' and priority =
'$myprivl' and updated = '1' and autofinger.interest=accounts.userid");

    while($new_row = mysql_fetch_row($privarray)) {
      $autoreadlist[] = $new_row;
    }

$o=0;
while ($autoreadlist[$o][0])
{
echo "<tr><td></td><td></td><td><p class=\"imagelev3\">&nbsp;</p></td>";
echo "<td><a href=\"read.php?myprivl=" . $myprivl . "&searchnum=" .
$autoreadlist[$o][0] . "\" class=\"lev3\">" .
$autoreadlist[$o][1] . "</a></td></tr>\n";

 $o++;}

if (!($myprivl == 3))
 {if (!($myprivl == 2))
 {priority_link($myurl, 2);}
 priority_link($myurl, 3);
}



?>
</table>
</td></tr></table>
</td></tr></table>
<?
disclaimer();
?>

</body></html>
<?
}



?>
